<Window x:Class="shahmati.Views.AdminWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Панель администратора" 
        Height="700" Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E"
        Foreground="White">

    <Window.Resources>
        <!-- Стандартные конвертеры WPF -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- Стиль для кнопок -->
        <Style TargetType="Button">
            <Setter Property="Background" Value="#3E3E3E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#555555"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4E4E4E"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#2E2E2E"/>
                    <Setter Property="Foreground" Value="#888888"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для текстовых полей -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#2E2E2E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
        </Style>

        <!-- Стиль для DataGrid -->
        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="#2E2E2E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555555"/>
            <Setter Property="AlternatingRowBackground" Value="#252525"/>
            <Setter Property="RowBackground" Value="#2E2E2E"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="IsReadOnly" Value="True"/>
        </Style>

        <!-- Стиль для заголовков DataGrid -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#3E3E3E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555555"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="10,5"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Шапка -->
        <Border Grid.Row="0" Background="#2E2E2E" Padding="20">
            <StackPanel>
                <TextBlock Text="🎮 АДМИН-ПАНЕЛЬ" 
                           FontSize="24" FontWeight="Bold"
                           Foreground="#4FC3F7"/>

                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <TextBlock Text="Статистика: " FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Stats.TotalUsers, StringFormat='Пользователи: {0}'}" Margin="20,0,0,0"/>
                    <TextBlock Text="{Binding Stats.TotalGames, StringFormat='Игры: {0}'}" Margin="20,0,0,0"/>
                    <TextBlock Text="{Binding Stats.ActiveGames, StringFormat='Активные: {0}'}" Margin="20,0,0,0"/>
                    <TextBlock Text="{Binding Stats.Admins, StringFormat='Админы: {0}'}" Margin="20,0,0,0"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Основной контент -->
        <Border Grid.Row="1" Background="#1E1E1E" Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Панель управления -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                    <TextBox Width="300" 
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Поиск по имени, email или роли"/>

                    <Button Content="🔄 Обновить" 
                            Command="{Binding RefreshCommand}"
                            ToolTip="Обновить данные"/>

                    <Button Content="📊 Экспорт" 
                            Command="{Binding ExportUsersCommand}"
                            ToolTip="Экспортировать в CSV"/>

                    <TextBlock Text="{Binding StatusMessage}" 
                               Margin="20,0,0,0"
                               VerticalAlignment="Center"
                               Foreground="#81C784"/>
                </StackPanel>

                <!-- Список пользователей -->
                <DataGrid Grid.Row="1" 
                          ItemsSource="{Binding FilteredUsers}"
                          SelectedItem="{Binding SelectedUser}"
                          AutoGenerateColumns="False"
                          CanUserResizeColumns="True"
                          CanUserReorderColumns="True">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" 
                                            Binding="{Binding Id}" 
                                            Width="60"/>
                        <DataGridTextColumn Header="Логин" 
                                            Binding="{Binding Username}" 
                                            Width="150"/>
                        <DataGridTextColumn Header="Email" 
                                            Binding="{Binding Email}" 
                                            Width="200"/>
                        <DataGridTextColumn Header="Роль" 
                                            Binding="{Binding Role}" 
                                            Width="100"/>
                        <DataGridCheckBoxColumn Header="Блок" 
                                                Binding="{Binding IsBlocked}" 
                                                Width="60"/>
                        <DataGridCheckBoxColumn Header="Актив" 
                                                Binding="{Binding IsActive}" 
                                                Width="60"/>
                        <DataGridTextColumn Header="Рейтинг" 
                                            Binding="{Binding Rating}" 
                                            Width="80"/>
                        <DataGridTextColumn Header="Создан" 
                                            Binding="{Binding CreatedAt, StringFormat=dd.MM.yyyy}" 
                                            Width="100"/>
                        <DataGridTextColumn Header="Последний вход" 
                                            Binding="{Binding LastLogin, StringFormat=dd.MM.yyyy HH:mm}" 
                                            Width="120"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Панель действий -->
        <Border Grid.Row="2" Background="#252525" Padding="20">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Выбран пользователь: " 
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"/>

                <TextBlock Text="{Binding SelectedUser.Username}" 
                           Margin="10,0,0,0"
                           VerticalAlignment="Center"
                           FontWeight="Bold"
                           Foreground="#4FC3F7"/>

                <Button Content="👑 Сделать админом" 
                        Command="{Binding MakeAdminCommand}"
                        Margin="30,0,0,0"
                        IsEnabled="{Binding IsUserSelected}"
                        Background="#1976D2"/>

                <Button Content="👤 Сделать клиентом" 
                        Command="{Binding MakeClientCommand}"
                        Margin="10,0,0,0"
                        IsEnabled="{Binding IsUserSelected}"
                        Background="#388E3C"/>

                <!-- Кнопка блокировки/разблокировки -->
                <Button Command="{Binding ToggleBlockCommand}"
                        Margin="10,0,0,0"
                        IsEnabled="{Binding IsUserSelected}"
                        Background="#D32F2F">
                    <Button.Content>
                        <TextBlock>
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="⛔ Заблокировать"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedUser.IsBlocked}" Value="True">
                                            <Setter Property="Text" Value="✅ Разблокировать"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Button.Content>
                </Button>

                <Button Content="🗑️ Удалить" 
                        Command="{Binding DeleteUserCommand}"
                        Margin="10,0,0,0"
                        IsEnabled="{Binding IsUserSelected}"
                        Background="#7B1FA2"/>

                <Button Content="❌ Закрыть" 
                        Command="{Binding CloseCommand}"
                        Margin="50,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- Индикатор загрузки -->
        <Border Grid.RowSpan="3" 
                Background="#80000000" 
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Width="200" Height="20" IsIndeterminate="True"/>
                <TextBlock Text="Загрузка данных..." 
                           Margin="0,10,0,0"
                           HorizontalAlignment="Center"
                           Foreground="White"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>